---
permalink: admin/kms-considerations-for-changing-for-site.html 
sidebar: sidebar 
keywords: kms cluster, copy kms encryption key 
summary: 各キー管理サーバ（ KMS ）または KMS クラスタは、 1 つのサイトまたはサイトグループにあるすべてのアプライアンスノードに暗号化キーを提供します。サイトで使用する KMS を変更する必要がある場合は、暗号化キーを KMS から別の KMS にコピーする必要があります。 
---
= サイトの KMS を変更する際の考慮事項
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
各キー管理サーバ（ KMS ）または KMS クラスタは、 1 つのサイトまたはサイトグループにあるすべてのアプライアンスノードに暗号化キーを提供します。サイトで使用する KMS を変更する必要がある場合は、暗号化キーを KMS から別の KMS にコピーする必要があります。

サイトで使用されている KMS を変更する場合は、そのサイトで以前に暗号化したアプライアンスノードを新しい KMS に格納されているキーを使用して復号化できることを確認する必要があります。場合によっては、暗号化キーの現在のバージョンを元の KMS から新しい KMS にコピーする必要があります。サイトで暗号化されたアプライアンスノードを復号化するために、 KMS に正しいキーがあることを確認する必要があります。

例：

. 最初に、専用のKMSを持たないすべてのサイトを環境 するデフォルトKMSを構成します。
. KMS を保存すると、「 Node Encryption * 」設定が有効になっているすべてのアプライアンスノードが KMS に接続して暗号化キーを要求します。このキーは、すべてのサイトのアプライアンスノードの暗号化に使用されます。同じキーを使用して、これらのアプライアンスを復号化する必要もあります。
+
image::../media/kms_default_key.png[KMS デフォルトキー]

. 1 つのサイト（図のデータセンター 3 ）にサイト固有の KMS を追加することにしました。ただし、アプライアンスノードはすでに暗号化されているため、サイト固有の KMS の設定を保存しようとすると検証エラーが発生します。このエラーは、サイト固有の KMS に、そのサイトでノードを復号化するための正しいキーがないことが原因で発生します。
+
image::../media/kms_wrong_key.png[KMS の間違ったキー]

. 問題 に対応するには、現在のバージョンの暗号化キーをデフォルトの KMS から新しい KMS にコピーします。（技術的には、元のキーを同じエイリアスを持つ新しいキーにコピーします。元のキーは新しいキーの以前のバージョンになります）。サイト固有のKMSに、データセンター3のアプライアンスノードを復号化するための正しいキーが追加され、StorageGRIDに保存できるようになりました。
+
image::../media/kms_copied_key.png[KMS がキーをコピーしました]





== サイトに使用する KMS を変更するユースケース

次の表に、サイトの KMS を変更する一般的なケースに必要な手順をまとめます。

[cols="1a,2a"]
|===
| サイトの KMS を変更するユースケース | 必要な手順 


 a| 
サイト固有の KMS エントリが 1 つ以上あり、それらのエントリの 1 つをデフォルトの KMS として使用する必要があります。
 a| 
サイト固有の KMS を編集します。[ * キー管理対象 * ] フィールドで、別の KMS （デフォルト KMS ）で管理されていないサイト * を選択します。サイト固有の KMS がデフォルトの KMS として使用されるようになります。それは専用のKMSを持っていないすべてのサイトに適用されます。

link:kms-editing.html["キー管理サーバ（ KMS ）を編集する"]



 a| 
デフォルトの KMS を使用して、拡張時に新しいサイトを追加する必要があります。新しいサイトにはデフォルトのKMSを使用しないでください。
 a| 
. 新しいサイトにあるアプライアンスノードがデフォルトの KMS によって暗号化済みの場合は、 KMS ソフトウェアを使用して、現在のバージョンの暗号化キーをデフォルトの KMS から新しい KMS にコピーします。
. Grid Manager を使用して新しい KMS を追加し、サイトを選択します。


link:kms-adding.html["キー管理サーバ（ KMS ）を追加する"]



 a| 
サイトの KMS で別のサーバを使用するとします。
 a| 
. サイトのアプライアンスノードが既存の KMS によって暗号化済みの場合は、 KMS ソフトウェアを使用して、既存の KMS から新しい KMS に暗号化キーの現在のバージョンをコピーします。
. Grid Manager を使用して既存の KMS 設定を編集し、新しいホスト名または IP アドレスを入力します。


link:kms-adding.html["キー管理サーバ（ KMS ）を追加する"]

|===