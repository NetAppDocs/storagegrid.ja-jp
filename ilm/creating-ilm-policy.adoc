---
permalink: ilm/creating-ilm-policy.html 
sidebar: sidebar 
keywords: how to create ILM policy 
summary: QoS要件を満たすILMポリシーを1つ以上作成します。 
---
= ILMポリシーの作成
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
QoS要件を満たすILMポリシーを1つ以上作成します。

アクティブなILMポリシーを1つにすると、すべてのテナントとバケットに同じILMルールを適用できます。

複数のアクティブなILMポリシーを設定することで、特定のテナントやバケットに適切なILMルールを適用して、複数のQoS要件を満たすことができます。



== ILMポリシーを作成します

.タスクの内容
独自のポリシーを作成する前に、がストレージ要件を満たしていないことを確認してlink:ilm-policy-overview.html#default-ilm-policy["デフォルトのILMポリシー"]ください。


NOTE: テストシステムでは、システム提供のポリシー（2コピーポリシー（1サイトグリッドの場合）または1サイトあたり1コピー（マルチサイトグリッドの場合）のみを使用してください。StorageGRID 11.6以前の場合、このポリシーのデフォルトルールでは、すべてのサイトが含まれるAll Storage Nodesストレージプールを使用します。StorageGRID システムに複数のサイトがある場合は、 1 つのオブジェクトのコピーが同じサイトに 2 つ配置される可能性があります。


NOTE: の場合link:enabling-s3-object-lock-globally.html["グローバルS3オブジェクトロック設定が有効になりました"]は、ILMポリシーがS3オブジェクトロックが有効になっているバケットの要件に準拠していることを確認する必要があります。このセクションでは、S3オブジェクトロックを有効にする手順を実行します。

.開始する前に
* Grid Managerにサインインしておきますlink:../admin/web-browser-requirements.html["サポートされている Web ブラウザ"]。
* あなたはを持っていますlink:../admin/admin-group-permissions.html["必要なアクセス権限"]。
* S3オブジェクトロックが有効になっているかどうかに基づいて設定しておきlink:access-create-ilm-rule-wizard.html["ILMルールが作成されました"]ます。
+
[role="tabbed-block"]
====
.S3オブジェクトロックが有効になっていません
--
** ポリシーにを追加する必要がありlink:what-ilm-rule-is.html["ILMルールを作成しました"]ます。必要に応じて、ポリシーを保存して追加のルールを作成し、ポリシーを編集して新しいルールを追加できます。
** フィルタが含まれていないがありlink:creating-default-ilm-rule.html["デフォルトの ILM ルールが作成されました"]ます。


--
.S3オブジェクトロックが有効になりました
--
** StorageGRIDシステム用の。link:enabling-s3-object-lock-globally.html["グローバルS3オブジェクトロック設定はすでに有効になっています"]
** ポリシーにを追加する必要がありlink:what-ilm-rule-is.html["準拠ILMルールと非準拠ILMルールを作成しました"]ます。必要に応じて、ポリシーを保存して追加のルールを作成し、ポリシーを編集して新しいルールを追加できます。
** に準拠しているポリシーのを指定しlink:creating-default-ilm-rule.html["デフォルトの ILM ルールが作成されました"]ます。


--
====
* オプションとして、ビデオを視聴しました:


.ILMポリシーの概要
video::e768d4da-da88-413c-bbaa-b1ff00874d10[panopto]
も参照してくださいlink:ilm-policy-overview.html["ILMポリシーを使用する"]。

.手順
. 「 * ILM * > * Policies * 」を選択します。
+
グローバルなS3オブジェクトロック設定が有効になっている場合は、[ILM policies]ページに、どのILMルールが準拠しているかが示されます。

. ILMポリシーの作成方法を決定します。
+
[role="tabbed-block"]
====
.新しいポリシーを作成する
--
.. [ポリシーの作成]*を選択します。


--
.既存のポリシーをクローニングする
--
.. 開始するポリシーのチェックボックスを選択し、*[クローン]*を選択します。


--
.既存のポリシーを編集する
.. アクティブでないポリシーは編集できます。最初に使用する非アクティブポリシーのチェックボックスを選択し、*[編集]*を選択します。


====


. [ポリシー名]*フィールドに、ポリシーの一意の名前を入力します。
. 必要に応じて、*[Reason for change]*フィールドに、新しいポリシーを作成する理由を入力します。
. ポリシーにルールを追加するには、*[ルールの選択]*を選択します。ルール名を選択すると、そのルールの設定が表示されます。
+
--
ポリシーをクローニングする場合は、次の手順を実行します。

** クローニングするポリシーで使用されているルールが選択されます。
** クローニングするポリシーで、デフォルトルールではないフィルタを使用していないルールが使用されている場合は、それらのルールを 1 つだけ残して、それを除くすべてのルールを削除するように求められます。
** デフォルトルールでフィルタを使用している場合は、新しいデフォルトルールを選択するように求められます。
** デフォルトルールが最後のルールでなかった場合は、新しいポリシーの末尾にルールを移動できます。


--
+
[role="tabbed-block"]
====
.S3オブジェクトロックが有効になっていません
--
.. ポリシーのデフォルトルールを1つ選択します。新しいデフォルトルールを作成するには、*[ILM rules]ページ*を選択します。
+
デフォルトルールは、ポリシー内の別のルールに一致しないオブジェクトを環境 します。デフォルトルールはフィルタを使用できず、常に最後に評価されます。

+

NOTE: Make 2 Copiesルールをポリシーのデフォルトルールとして使用しないでください。Make 2 Copies ルールは、 1 つのストレージプールであるすべてのストレージノードを使用します。このプールにはすべてのサイトが含まれています。StorageGRID システムに複数のサイトがある場合は、 1 つのオブジェクトのコピーが同じサイトに 2 つ配置される可能性があります。



--
.S3オブジェクトロックが有効になりました
--
.. ポリシーのデフォルトルールを1つ選択します。新しいデフォルトルールを作成するには、*[ILM rules]ページ*を選択します。
+
ルールのリストには、準拠しており、フィルタを使用しないルールのみが含まれています。

+

NOTE: Make 2 Copiesルールをポリシーのデフォルトルールとして使用しないでください。Make 2 Copies ルールは、 1 つのストレージプールであるすべてのストレージノードを使用します。このプールにはすべてのサイトが含まれています。このルールを使用すると、 1 つのオブジェクトの複数のコピーが同じサイトに配置される場合があります。

.. S3非準拠バケット内のオブジェクトに別の「デフォルト」ルールが必要な場合は、*[非準拠S3バケットに対してフィルタなしのルールを含める]*を選択し、フィルタを使用しない非準拠ルールを1つ選択します。
+
たとえば、クラウドストレージプールを使用して、S3オブジェクトロックが有効になっていないバケットにオブジェクトを格納できます。

+

NOTE: フィルタを使用しない非準拠ルールは 1 つだけ選択できます。



も参照してくださいlink:example-7-compliant-ilm-policy-for-s3-object-lock.html["例 7 ： S3 オブジェクトロックの準拠 ILM ポリシー"]。

--
====


. デフォルトルールの選択が完了したら、* Continue *を選択します。
. [Other rules]ステップで、ポリシーに追加する他のルールを選択します。これらのルールでは、少なくとも1つのフィルタ（テナントアカウント、バケット名、高度なフィルタ、最新でない参照時間）を使用します。次に、*[選択]*を選択します。
+
[Create a policy]ウィンドウに、選択したルールが表示されます。デフォルトのルールは末尾にあり、その上に他のルールがあります。

+
S3オブジェクトロックが有効になっていて、非準拠の「デフォルト」ルールも選択した場合、そのルールはポリシーの最後から2番目のルールとして追加されます。

+

NOTE: オブジェクトを無期限に保持しないルールがある場合は、警告が表示されます。このポリシーをアクティブ化するときは、デフォルトルールの配置手順が経過したときにStorageGRID でオブジェクトを削除することを確認する必要があります（バケットライフサイクルによってオブジェクトが長期間保持される場合を除く）。

. デフォルト以外のルールの行をドラッグして、これらのルールを評価する順序を決定します。
+
デフォルトのルールは移動できません。S3オブジェクトロックが有効になっている場合は、非準拠の「デフォルト」ルールを選択しても移動できません。

+

NOTE: ILM ルールの順序が正しいことを確認してください。ポリシーをアクティブ化すると、新規および既存のオブジェクトがリスト内の順にルールによって評価されます。

. 必要に応じて、*[ルールの選択]*を選択してルールを追加または削除します。
. 完了したら、 * 保存 * を選択します。
. 上記の手順を繰り返して、追加のILMポリシーを作成します。
. <<simulate-ilm-policy,ILM ポリシーをシミュレートします>>です。ポリシーが想定どおりに機能するように、アクティブ化する前に必ずポリシーをシミュレートしてください。




== ポリシーをシミュレートする

ポリシーをアクティブ化して本番環境のデータに適用する前に、テストオブジェクトでポリシーをシミュレートします。

.開始する前に
* テストする各オブジェクトのS3バケット/オブジェクトキーを確認しておきます。


.手順
. S3クライアントまたはを使用してlink:../tenant/use-s3-console.html["S3コンソール"]、各ルールのテストに必要なオブジェクトを取り込みます。
. [ILM policies]ページで、ポリシーのチェックボックスを選択し、*[Simulate]*を選択します。
. [* Object *]フィールドに、テストオブジェクトのS3を入力し `bucket/object-key`ます。たとえば、 `bucket-01/filename.png`です。
. S3のバージョン管理が有効になっている場合は、必要に応じて* Version ID *フィールドにオブジェクトのバージョンIDを入力します。
. 「 * Simulate * 」を選択します。
. [Simulation results]セクションで、各オブジェクトが正しいルールに一致したことを確認します。
. 有効なストレージプールまたはイレイジャーコーディングプロファイルを確認するには、一致したルールの名前を選択してルールの詳細ページに移動します。



CAUTION: 既存のレプリケートオブジェクトとイレイジャーコーディングオブジェクトの配置に対する変更を確認します。既存のオブジェクトの場所を変更すると、新しい配置が評価されて実装される際に一時的なリソースの問題が発生する可能性があります。

.結果
ポリシーのルールに対する編集はシミュレーション結果に反映され、新しい一致と以前の一致が表示されます。[ポリシーをシミュレート（Simulate policy）]ウィンドウには、[シミュレーション結果（Simulation results）]リストで*[すべてクリア（Clear All）]*または[除去（remove）]アイコンを選択するまで、テストしたオブジェクトが保持されimage:../media/icon-x-to-remove.png["削除アイコン"]ます

.関連情報
link:simulating-ilm-policy-examples.html["ILMポリシーのシミュレーション例"]



== ポリシーをアクティブ化する

1つの新しいILMポリシーをアクティブ化すると、既存のオブジェクトと新しく取り込まれたオブジェクトがそのポリシーで管理されます。複数のポリシーをアクティブ化すると、バケットに割り当てられたILMポリシータグによって管理対象のオブジェクトが決まります。

新しいポリシーをアクティブ化する前に：

. ポリシーをシミュレートして、想定どおりに動作することを確認します。
. 既存のレプリケートオブジェクトとイレイジャーコーディングオブジェクトの配置に対する変更を確認します。既存のオブジェクトの場所を変更すると、新しい配置が評価されて実装される際に一時的なリソースの問題が発生する可能性があります。



CAUTION: 原因 ポリシーにエラーがあると、回復不能なデータ損失が発生する可能性があります。

.タスクの内容
ILM ポリシーをアクティブ化すると、システムは新しいポリシーをすべてのノードに配布します。ただし、すべてのグリッドノードが新しいアクティブポリシーを受信できるようになるまで、新しいポリシーが実際には有効にならない場合があります。グリッドオブジェクトが誤って削除されないように、新しいアクティブポリシーの実装を待機する場合もあります。具体的には：

* データの冗長性や耐久性を高める*ポリシーを変更すると、変更はすぐに実装されます。たとえば、 2 コピーのルールではなく 3 コピーのルールを含む新しいポリシーをアクティブ化した場合、そのポリシーはすぐに実装されます。これは、データの冗長性が向上するためです。
* データの冗長性や保持性を低下させる可能性がある*ポリシーを変更した場合、すべてのグリッドノードが使用可能になるまで変更は実装されません。たとえば、3コピーのルールではなく2コピーのルールを使用する新しいポリシーをアクティブ化すると、その新しいポリシーは[Active policy]タブに表示されますが、すべてのノードがオンラインで使用可能になるまで有効になりません。


.手順
1つまたは複数のポリシーをアクティブ化する手順に従います。

[role="tabbed-block"]
====
.1つのポリシーをアクティブ化
--
アクティブなポリシーを1つだけにする場合は、次の手順を実行します。すでにアクティブなポリシーが1つ以上あり、追加のポリシーをアクティブ化する場合は、次の手順に従って複数のポリシーをアクティブ化します。

. ポリシーをアクティブ化する準備ができたら、*[ILM]*>*[Policies]*を選択します。
+
または、* ILM *>* Policy tags *ページで1つのポリシーをアクティブ化することもできます。

. [ポリシー]タブで、アクティブ化するポリシーのチェックボックスを選択し、*[アクティブ化]*を選択します。
. 該当する手順を実行します。
+
** ポリシーをアクティブ化するかどうかを確認する警告メッセージが表示されたら、* OK *を選択します。
** ポリシーの詳細を含む警告メッセージが表示された場合は、次の手順を実行します。
+
... 詳細を確認して、ポリシーでデータが想定どおりに管理されることを確認します。
... デフォルトのルールでオブジェクトが限られた日数だけ格納される場合は、保持図を確認し、その日数をテキストボックスに入力します。
... デフォルトのルールでオブジェクトが無期限に格納され、保持期間が制限されているルールがある場合は、テキストボックスに「* yes *」と入力します。
... [ポリシーのアクティブ化]*を選択します。






--
.複数のポリシーのアクティブ化
--
複数のポリシーを有効にするには、ポリシー タグを作成し、各タグにポリシーを割り当てる必要があります。グリッドには最大 10 個のポリシー タグを作成できます。


TIP: 複数のポリシー タグが使用されている場合、テナントがバケットにポリシー タグを頻繁に再割り当てすると、グリッドのパフォーマンスに影響が出る可能性があります。信頼できないテナントがある場合は、デフォルト ポリシー タグのみを使用することを検討してください。

. [ILM]*>*[Policy tags]*を選択します。
. 「 * Create * 」を選択します。
. [ポリシータグの作成]ダイアログボックスで、タグ名とタグの概要（オプション）を入力します。
+

NOTE: タグの名前と説明はテナントに表示されます。バケットに割り当てるポリシータグをテナントが選択する際に十分な情報に基づいて決定するのに役立つ値を選択してください。たとえば、割り当てられているポリシーによって一定の期間が経過したあとにオブジェクトが削除される場合は、概要でその旨を通知できます。これらのフィールドには機密情報を含めないでください。

. [タグの作成]*を選択します。
. ILMポリシータグの表で、プルダウンを使用してタグに割り当てるポリシーを選択します。
. [ポリシーの制限]列に警告が表示された場合は、*[ポリシーの詳細を表示]*を選択してポリシーを確認します。
. 各ポリシーが想定どおりにデータを管理することを確認します。
. [割り当てられたポリシーをアクティブ化する]*を選択します。または、*[変更のクリア]*を選択してポリシーの割り当てを削除します。
. [Activate policies with new tags]ダイアログボックスで、各タグ、ポリシー、およびルールによるオブジェクトの管理方法の説明を確認します。ポリシーでオブジェクトが想定どおりに管理されるように、必要に応じて変更を行います。
. ポリシーをアクティブ化する場合は、テキストボックスに「* yes *」と入力し、*[ポリシーのアクティブ化]*を選択します。


--
====
.関連情報
link:example-6-changing-ilm-policy.html["例 6 ： ILM ポリシーを変更する"]
