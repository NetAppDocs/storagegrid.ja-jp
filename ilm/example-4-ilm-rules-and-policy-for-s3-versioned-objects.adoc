---
permalink: ilm/example-4-ilm-rules-and-policy-for-s3-versioned-objects.html 
sidebar: sidebar 
keywords: object versions, example ILM rule, information lifecycle rule examples 
summary: 'バージョン管理が有効なS3バケットでは、[Reference Time]に[Noncurrent time]を指定するルールをILMポリシーに含めることで、最新でないオブジェクトバージョンを管理できます。' 
---
= 例 4 ： S3 バージョン管理オブジェクトの ILM ルールとポリシー
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
バージョン管理が有効なS3バケットでは、参照時間として「noncurrent time」を使用するルールをILMポリシーに含めることで、最新でないオブジェクトバージョンを管理できます。


CAUTION: 制限された保持期間を指定したオブジェクトは、指定した期間の経過後に完全に削除されます。オブジェクトが保持される期間を確認してください。

この例に示すように、バージョン管理オブジェクトで使用されるストレージの量を制御するには、最新でないオブジェクトバージョンに別々の配置手順を使用します。


CAUTION: 以下の ILM ルールとポリシーは一例にすぎません。ILM ルールを設定する方法は多数あります。新しいポリシーをアクティブ化する前に、ポリシーをシミュレートして、コンテンツを損失から保護するために意図したとおりに機能することを確認します。


NOTE: 最新でないバージョンのオブジェクトに対してILMポリシーのシミュレーションを実行するには、オブジェクトバージョンのUUIDまたはCBIDを確認しておく必要があります。UUIDとCBIDを確認するには、オブジェクトが最新の状態でを使用しますlink:verifying-ilm-policy-with-object-metadata-lookup.html["オブジェクトメタデータの検索"]。

.関連情報
link:how-objects-are-deleted.html["オブジェクトの削除方法"]



== 例 4 の ILM ルール 1 ：コピーを 3 つ、 10 年間保存します

この例のILMルールでは、各オブジェクトのコピーが3つのサイトに10年間格納されます。

このルールは、オブジェクトがバージョン管理されているかどうかに関係なく、すべてのオブジェクトを環境 します。

[cols="1a,2a"]
|===
| ルール定義 | 値の例 


 a| 
ストレージプール
 a| 
サイト1、サイト2、サイト3という名前の異なるデータセンターで構成される3つのストレージプール。



 a| 
ルール名
 a| 
3 つのコピー 10 年



 a| 
参照時間
 a| 
取り込み時間



 a| 
配置
 a| 
0日目から、3つのレプリケートコピーを10年間（3、652日）（サイト1に1つ、サイト2に1つ、サイト3に1つ）保存します。10 年後にオブジェクトのコピーをすべて削除する。

|===


== 例 4 の ILM ルール 2 ：最新でないバージョンのコピーを 2 つ、 2 年間保存します

この例では、最新でないバージョンの S3 バージョン管理オブジェクトのコピーを 2 つ、 2 年間格納します。

ILM ルール 1 ではすべてのバージョンのオブジェクトが環境 されるため、最新でないバージョンをすべて除外する別のルールを作成する必要があります。

「noncurrent time」を参照時間として使用するルールを作成するには、「Apply this rule to older object versions only（S3バケットでバージョン管理が有効になっている場合）？」で* Yes *を選択します。 [Create an ILM rule]ウィザードの[Step 1（Enter details）]で、* Yes *を選択すると、参照時間として_noncurrent time_が自動的に選択され、別の参照時間を選択することはできません。

image::../media/ilm-rule-apply-only-to-older-object-verions.png[古いバージョンのオブジェクトにのみILMルールを適用（最新でない時間）]

この例では、最新でないバージョンのコピーが 2 つだけ格納され、その期間は 2 年間です。

[cols="1a,2a"]
|===
| ルール定義 | 値の例 


 a| 
ストレージプール
 a| 
2つのストレージプールがそれぞれ異なるデータセンター（サイト1とサイト2）にある。



 a| 
ルール名
 a| 
最新でないバージョン： 2 コピー 2 年



 a| 
参照時間
 a| 
最新でない時間

「Apply this rule to older object versions only（S3バケットでバージョン管理が有効になっている場合）？」という質問で* Yes *を選択すると、自動的に選択されます。 Create an ILM Ruleウィザードを使用します。



 a| 
配置
 a| 
最新でない時間に対して（オブジェクトバージョンが最新でなくなった日から）0日目に、最新でないオブジェクトバージョンのレプリケートコピーを2つ（サイト1に1つ、サイト2に1つ）2年間（730日）保持します。2 年後に最新でないバージョンを削除します。

|===


== 例 4 の ILM ポリシー： S3 バージョン管理オブジェクト

古いバージョンのオブジェクトを現在のバージョンとは異なる方法で管理する場合は、ILMポリシーで参照時間に「noncurrent time」を使用するルールを、現在のオブジェクトバージョンに適用されるルールの前に配置する必要があります。

S3 バージョン管理オブジェクトの ILM ポリシーには、次のような ILM ルールが含まれます。

* 古い（最新でない）バージョンの各オブジェクトを、そのバージョンが最新でなくなった日から 2 年間保持します。
+

NOTE: 「noncurrent time」ルールは、ポリシー内で現在のオブジェクトバージョンに適用されるルールの前に配置する必要があります。そうしないと、最新でないオブジェクトバージョンが「noncurrent time」ルールに一致しなくなります。

* 取り込み時に、レプリケートコピーを3つ作成し、3つのサイトそれぞれに1つのコピーを格納します。最新のオブジェクトバージョンのコピーを 10 年間保持します。


この例のポリシーをシミュレートすると、テストオブジェクトは次のように評価されます。

* 最新でないオブジェクトバージョンがすべて最初のルールに一致します。最新でないオブジェクトバージョンが 2 年以上経過している場合は、 ILM によって完全に削除されます（最新でないバージョンのコピーがすべてグリッドから削除されます）。
* 現在のオブジェクトバージョンが 2 つ目のルールに一致します。現在のオブジェクトバージョンが10年間格納されている場合、ILMプロセスはオブジェクトの現在のバージョンとして削除マーカーを追加し、以前のオブジェクトバージョンを「noncurrent」にします。次回のILM評価では、この最新でないバージョンが最初のルールに一致します。その結果、サイト3のコピーがパージされ、サイト1とサイト2の2つのコピーがさらに2年間格納されます。

