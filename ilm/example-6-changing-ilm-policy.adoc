---
permalink: ilm/example-6-changing-ilm-policy.html 
sidebar: sidebar 
keywords: change ILM policy, example ILM policy, information lifecycle policy example 
summary: データ保護の変更や新しいサイトの追加が必要な場合は、新しいILMポリシーを作成してアクティブ化できます。 
---
= 例6：ILMポリシーを変更する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
データ保護の変更や新しいサイトの追加が必要な場合は、新しいILMポリシーを作成してアクティブ化できます。

ポリシーを変更する前に、 ILM の配置変更が一時的に StorageGRID システムの全体的なパフォーマンスに及ぼす影響について理解しておく必要があります。

この例では、拡張時に新しいStorageGRID サイトが追加されたため、新しいサイトにデータを格納するために新しいアクティブなILMポリシーを実装する必要があります。新しいアクティブポリシーを実装するには、まず最初にlink:creating-ilm-policy.html["ポリシーを作成します。"]実行します。その後、 link:../ilm/creating-ilm-policy.html#activate-ilm-policy["アクティブ化"]新しいポリシーを実行する必要がありますlink:../ilm/creating-ilm-policy.html#simulate-ilm-policy["シミュレートします"]。


CAUTION: 以下の ILM ルールとポリシーは一例にすぎません。ILM ルールを設定する方法は多数あります。新しいポリシーをアクティブ化する前に、ポリシーをシミュレートして、コンテンツを損失から保護するために意図したとおりに機能することを確認します。



== ILMポリシーの変更がパフォーマンスに与える影響

新しい ILM ポリシーをアクティブ化すると、特に新しいポリシーの配置手順で多数の既存オブジェクトの新しい場所への移動が必要になった場合には、 StorageGRID システムのパフォーマンスに一時的に影響する可能性があります。

新しい ILM ポリシーをアクティブ化すると、 StorageGRID は、そのポリシーを使用して、既存のオブジェクトと新たに取り込まれたオブジェクトを含むすべてのオブジェクトを管理します。新しい ILM ポリシーをアクティブ化する前に、既存のレプリケートオブジェクトとイレイジャーコーディングオブジェクトの配置に対する変更を確認してください。既存のオブジェクトの場所を変更すると、新しい配置が評価されて実装される際に一時的なリソースの問題が発生する可能性があります。

新しいILMポリシーが既存のレプリケートオブジェクトとイレイジャーコーディングオブジェクトの配置に影響しないようにすることができますlink:create-ilm-rule-enter-details.html#use-advanced-filters-in-ilm-rules["取り込み時間フィルタを使用してILMルールを作成する"]。たとえば、*取り込み時間_が___<date and time> _*以降であるため、新しいルールは指定した日時以降に取り込まれたオブジェクトにのみ適用されます。

StorageGRID のパフォーマンスに一時的に影響する可能性がある ILM ポリシーの変更には、次のようなものがあります。

* 既存のイレイジャーコーディングオブジェクトに別のイレイジャーコーディングプロファイルを適用する。
+

NOTE: StorageGRIDでは、イレイジャーコーディングプロファイルはそれぞれ一意であるとみなされ、新しいプロファイルの使用時にイレイジャーコーディングフラグメントは再利用されません。

* 既存のオブジェクトに必要なコピーのタイプを変更する。たとえば、大部分のレプリケートオブジェクトをイレイジャーコーディングオブジェクトに変換する場合などです。
* 既存のオブジェクトのコピーをまったく別の場所に移動する。たとえば、クラウドストレージプールとリモートサイトの間で多数のオブジェクトを移動する場合などです。




== 例 6 のアクティブな ILM ポリシー： 2 つのサイトでのデータ保護

この例では、アクティブな ILM ポリシーは最初に 2 サイトの StorageGRID システム用に設計され、 2 つの ILM ルールを使用しています。

image::../media/policy_6_active_policy.png[例： ILM ポリシー 6 アクティブポリシー]

この ILM ポリシーでは、テナント A に属するオブジェクトが 1 つのサイトで 2+1 のイレイジャーコーディングによって保護され、一方他のすべてのテナントに属するオブジェクトは 2-copy レプリケーションを使用して 2 つのサイト間で保護されます。



=== ルール 1 ：テナント A に 1 つのサイトのイレイジャーコーディング

[cols="1a,2a"]
|===
| ルール定義 | 値の例 


 a| 
ルール名
 a| 
テナント A の 1 サイトのイレイジャーコーディング



 a| 
テナントアカウント
 a| 
テナントA



 a| 
ストレージプール
 a| 
サイト1



 a| 
配置
 a| 
2+1のイレイジャーコーディングをサイト1に格納し、0日目から無期限に格納します

|===


=== ルール 2 ：他のテナントに 2 つのサイトをレプリケートする

[cols="1a,2a"]
|===
| ルール定義 | 値の例 


 a| 
ルール名
 a| 
他のテナント用の 2 サイトレプリケーション



 a| 
テナントアカウント
 a| 
無視



 a| 
ストレージプール
 a| 
サイト1とサイト2



 a| 
配置
 a| 
2つのレプリケートコピーを0日目から無期限に（サイト1に1つ、サイト2に1つ）

|===


== 例6のILMポリシー：3サイトでのデータ保護

この例では、3サイトのStorageGRID システムのILMポリシーが新しいポリシーに置き換えられています。

拡張を実行して新しいサイトを追加したあと、グリッド管理者は2つの新しいストレージプールを作成しました。1つはサイト3のストレージプールで、もう1つは3つのサイトすべてを含むストレージプールです（デフォルトの[All Storage Nodes]ストレージプールとは異なります）。次に、2つの新しいILMルールと1つの新しいILMポリシーを作成しました。このポリシーは、3つのサイトすべてのデータを保護するように設計されています。

この新しい ILM ポリシーがアクティブ化されると、テナント A に属するオブジェクトが 3 つのサイトで 2+1 イレイジャーコーディングによって保護され、他のテナント（およびテナント A に属する小さいオブジェクト）に属するオブジェクトは 3 つのサイト間で 3 コピーレプリケーションによって保護されるようになります。



=== ルール 1 ：テナント A に 3 サイトイレイジャーコーディング

[cols="1a,2a"]
|===
| ルール定義 | 値の例 


 a| 
ルール名
 a| 
テナント A の 3 サイトイレイジャーコーディング



 a| 
テナントアカウント
 a| 
テナントA



 a| 
ストレージプール
 a| 
3つのサイトすべて（サイト1、サイト2、サイト3を含む）



 a| 
配置
 a| 
2+1のイレイジャーコーディングを3つのサイトすべてに0日目から無期限に格納

|===


=== ルール 2 ：他のテナントに 3 つのサイトをレプリケーションする

[cols="1a,2a"]
|===
| ルール定義 | 値の例 


 a| 
ルール名
 a| 
他のテナント用に 3 つのサイトにレプリケーション



 a| 
テナントアカウント
 a| 
無視



 a| 
ストレージプール
 a| 
サイト1、サイト2、およびサイト3



 a| 
配置
 a| 
3つのレプリケートコピーを0日目から無期限に（サイト1に1つ、サイト2に1つ、サイト3に1つ）

|===


== 例6のILMポリシーのアクティブ化

新しいILMポリシーをアクティブ化すると、新規または更新されたルールの配置手順に基づいて、既存のオブジェクトが新しい場所に移動されたり、既存のオブジェクト用の新しいオブジェクトコピーが作成されたりすることがあります。


CAUTION: 原因 ポリシーにエラーがあると、回復不能なデータ損失が発生する可能性があります。ポリシーをアクティブ化する前によく確認およびシミュレートし、想定どおりに機能することを確認してください。


CAUTION: 新しい ILM ポリシーをアクティブ化すると、 StorageGRID は、そのポリシーを使用して、既存のオブジェクトと新たに取り込まれたオブジェクトを含むすべてのオブジェクトを管理します。新しい ILM ポリシーをアクティブ化する前に、既存のレプリケートオブジェクトとイレイジャーコーディングオブジェクトの配置に対する変更を確認してください。既存のオブジェクトの場所を変更すると、新しい配置が評価されて実装される際に一時的なリソースの問題が発生する可能性があります。



=== イレイジャーコーディングの手順が変わったときの動作

この例の現在アクティブなILMポリシーでは、テナントAに属するオブジェクトがサイト1で2+1のイレイジャーコーディングを使用して保護されています。新しいILMポリシーでは、テナントAに属するオブジェクトを、サイト1、2、3で2+1のイレイジャーコーディングを使用して保護します。

新しい ILM ポリシーがアクティブ化されると、次の ILM 処理が実行されます。

* テナント A で取り込まれた新しいオブジェクトは 2 つのデータフラグメントに分割され、 1 つのパリティフラグメントが追加される。その後、3つのフラグメントそれぞれが別 々 のサイトに格納されます。
* テナント A に属する既存のオブジェクトは、実行中の ILM スキャンプロセスで再評価されます。ILMの配置手順では新しいイレイジャーコーディングプロファイルを使用するため、まったく新しいイレイジャーコーディングフラグメントが作成されて3つのサイトに分散されます。
+

NOTE: サイト1の既存の2+1フラグメントは再利用されません。StorageGRIDでは、イレイジャーコーディングプロファイルはそれぞれ一意であるとみなされ、新しいプロファイルの使用時にイレイジャーコーディングフラグメントは再利用されません。





=== レプリケーション手順が変わったときの動作

この例の現在アクティブなILMポリシーでは、他のテナントに属するオブジェクトが、サイト1と2のストレージプールに2つのレプリケートコピーを格納して保護されます。新しいILMポリシーでは、他のテナントに属するオブジェクトを、サイト1、2、3のストレージプールに3つのレプリケートコピーを格納して保護します。

新しい ILM ポリシーがアクティブ化されると、次の ILM 処理が実行されます。

* テナントA以外のテナントが新しいオブジェクトを取り込むと、StorageGRID はコピーを3つ作成して各サイトに1つずつ保存します。
* それらの他のテナントに属する既存のオブジェクトは、 ILM のスキャンプロセスの実行中に再評価されます。サイト1とサイト2の既存のオブジェクトコピーは新しいILMルールのレプリケーション要件を満たしているため、StorageGRID ではサイト3用にオブジェクトの新しいコピーを1つ作成するだけで済みます。




=== このポリシーをアクティブ化した場合のパフォーマンスへの影響

この例のILMポリシーをアクティブ化すると、このStorageGRIDシステムの全体的なパフォーマンスが一時的に低下します。テナントAの既存オブジェクト用に新しいイレイジャーコーディングフラグメントを作成し、他のテナントの既存オブジェクト用にサイト3にレプリケートコピーを作成するには、通常よりも多くのグリッドリソースが必要になります。

ILM ポリシーが変更されたため、クライアントの読み取り要求と書き込み要求が一時的に通常よりもレイテンシが高くなる可能性があります。配置手順がグリッド全体に完全に実装されたあと、レイテンシは通常レベルに戻ります。

新しいILMポリシーをアクティブ化する際のリソースの問題を回避するために、大量の既存オブジェクトの場所を変更する可能性があるルールでは、高度なフィルタの取り込み時間を使用できます。新しいポリシーが有効になるおおよその時間以上に取り込み時間を設定して、既存のオブジェクトが不要に移動されないようにします。


NOTE: ILM ポリシーの変更後にオブジェクトが処理される速度を遅くしたり、上げたりする必要がある場合は、テクニカルサポートにお問い合わせください。
