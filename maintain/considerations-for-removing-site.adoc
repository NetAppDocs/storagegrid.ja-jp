---
permalink: maintain/considerations-for-removing-site.html 
sidebar: sidebar 
keywords: how to remove site 
summary: サイトの運用停止手順 を使用してサイトを削除する前に、考慮事項を確認しておく必要があります。 
---
= サイトの削除に関する考慮事項
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
サイトの運用停止手順 を使用してサイトを削除する前に、考慮事項を確認しておく必要があります。



== サイトの運用を停止した場合の動作

サイトの運用を停止すると、 StorageGRID はサイトのすべてのノードとサイト自体を StorageGRID システムから完全に削除します。

サイトの運用停止手順 が完了したら、次の手順を実行します

* StorageGRID を使用してサイトやサイトの任意のノードを表示したり、アクセスしたりすることはできなくなります。
* サイトを参照していたストレージプールやイレイジャーコーディングプロファイルは使用できなくなります。StorageGRIDでサイトの運用を停止すると、ストレージプールが自動的に削除され、イレイジャーコーディングプロファイルが非アクティブ化されます。




== 接続されているサイトと切断されているサイトの運用停止手順の違い

サイト運用停止手順 を使用すると、すべてのノードが StorageGRID に接続されているサイト（接続されていないサイトの運用停止と呼ばれる）を削除したり、すべてのノードが StorageGRID から切断されているサイト（切断されたサイトの運用停止と呼ばれる）を削除したりできます。作業を開始する前に、これらの手順の違いを理解しておく必要があります。


NOTE: 接続されている（）ノードと切断されている（またはimage:../media/icon_alarm_blue_unknown.png["アイコンアラーム青不明"]）ノードimage:../media/icon_alarm_gray_administratively_down.png["アイコンのアラームグレーが管理上ダウンしています"]がサイトに混在している場合はimage:../media/icon_alert_green_checkmark.png["緑のチェックマークアイコン"]、オフラインのすべてのノードをオンラインに戻す必要があります。

* 接続されたサイトの運用停止機能を使用すると、 StorageGRID システムから運用サイトを削除できます。たとえば、接続されたサイトの運用停止を実行して、機能しているが不要になったサイトを削除できます。
* StorageGRID は、接続されているサイトを削除する際、 ILM を使用してサイトのオブジェクトデータを管理します。接続されたサイトの運用停止を開始するには、すべての ILM ルールからサイトを削除し、新しい ILM ポリシーをアクティブ化する必要があります。オブジェクトデータを移行するための ILM プロセスとサイトを削除するための内部プロセスは同時に発生する可能性がありますが、実際の運用停止手順 を開始する前に ILM の手順を完了しておくことを推奨します。
* 切断されたサイトの運用停止機能を使用すると、障害が発生したサイトを StorageGRID システムから削除できます。たとえば、切断されたサイトの運用停止を実行して、火災や洪水によって破壊されたサイトを削除できます。
+
切断されているサイトを削除すると、 StorageGRID はすべてのノードをリカバリ不能とみなし、データの保持を試みません。ただし、切断されたサイトの運用停止を開始する前に、サイトをすべての ILM ルールから削除して、新しい ILM ポリシーをアクティブ化する必要があります。

+

CAUTION: 切断されたサイトの運用停止手順 を実行する前に、ネットアップのアカウント担当者にお問い合わせください。運用停止サイトのウィザードですべての手順を有効にする前に、要件を確認してください。切断されているサイトの運用停止は、サイトをリカバリしたり、サイトからオブジェクトデータをリカバリしたりできる可能性がある場合は、試行しないでください。





== 接続されているサイトまたは切断されているサイトを削除するための一般的な要件

接続されているサイトや切断されているサイトを削除する前に、次の要件について確認しておく必要があります。

* プライマリ管理ノードを含むサイトは運用停止できません。
* いずれかのノードのインターフェイスがハイアベイラビリティ（HA）グループに属している場合は、サイトの運用を停止できません。HA グループを編集してノードのインターフェイスを削除するか、 HA グループ全体を削除する必要があります。
* 接続されている（）image:../media/icon_alarm_gray_administratively_down.png["アイコンのアラームグレーが管理上ダウンしています"]ノードと切断されている（image:../media/icon_alarm_blue_unknown.png["アイコンアラーム青不明"]または）ノードが混在しているサイトは運用停止できませんimage:../media/icon_alert_green_checkmark.png["緑のチェックマークアイコン"]。
* 他のサイトのいずれかのノードが切断されている（またはimage:../media/icon_alarm_gray_administratively_down.png["アイコンのアラームグレーが管理上ダウンしています"]）サイトは運用停止できませんimage:../media/icon_alarm_blue_unknown.png["アイコンアラーム青不明"]。
* ec-node-repair処理が実行中の場合は、サイトの運用停止手順 を開始できません。イレイジャーコーディングデータの修復の追跡については、を参照してくださいlink:checking-data-repair-jobs.html["データ修復ジョブを確認します"]。
* サイトの運用停止中は、手順 は次の処理を実行します。
+
** 運用停止するサイトを参照するILMルールを作成することはできません。また、既存のILMルールを編集してサイトを参照することもできません。
** 拡張やアップグレードなど、その他のメンテナンス手順は実行できません。
+

NOTE: 接続されているサイトの運用停止中に別のメンテナンス手順を実行する必要がある場合は、実行できますlink:pausing-and-resuming-decommission-process-for-storage-nodes.html["ストレージノードを削除している間に手順 を一時停止します"]。* Pause * ボタンは、 ILM 評価またはイレイジャーコーディングデータの運用停止ステージに達したときにのみ有効になります。ただし、 ILM 評価（データ移行）はバックグラウンドで継続して実行されます。2 つ目のメンテナンス手順 が完了したら、運用停止手順を再開できます。

** サイトの運用停止手順 の開始後にノードをリカバリする必要がある場合は、サポートにお問い合わせください。


* 一度に複数のサイトを運用停止することはできません。
* サイトに 1 つ以上の管理ノードが含まれており、 StorageGRID システムでシングルサインオン（ SSO ）が有効になっている場合は、そのサイトに対する証明書利用者信頼をすべて Active Directory フェデレーションサービス（ AD FS ）から削除する必要があります。




== 情報ライフサイクル管理（ ILM ）の要件

サイトを削除する場合は、 ILM 設定を更新する必要があります。Decommission Site ウィザードでは、次のことを確認するために、いくつかの前提条件となる手順を実行できます。

* このサイトはILMポリシーでは参照されていません。該当する場合は、ポリシーを編集するか、新しいILMルールを使用してポリシーを作成してアクティブ化する必要があります。
* サイトを参照するILMルールはありません。ルールがどのポリシーでも使用されていない場合でも同様です。サイトを参照するすべてのルールを削除または編集する必要があります。


StorageGRIDはサイトの運用を停止すると、サイトを参照している未使用のイレイジャーコーディングプロファイルを自動的に非アクティブ化し、サイトを参照している未使用のストレージプールを自動的に削除します。All Storage Nodesストレージプール（StorageGRID 11.6以前）が存在する場合は、すべてのサイトを使用するため削除されます。


CAUTION: サイトを削除する前に、新しい ILM ルールを作成して新しい ILM ポリシーをアクティブ化する必要がある場合があります。以下の手順は、ILMの仕組みを十分に理解していること、およびストレージプール、イレイジャーコーディングプロファイル、ILMルールの作成、およびILMポリシーのシミュレートとアクティブ化に精通していることを前提としています。を参照して link:../ilm/index.html["ILM を使用してオブジェクトを管理する"]



== 接続されているサイトでのオブジェクトデータに関する考慮事項

接続されたサイトの運用停止を実行する場合は、新しい ILM ルールと新しい ILM ポリシーを作成するときに、サイトの既存のオブジェクトデータで実行する処理を決定する必要があります。次のいずれか、または両方を実行できます。

* 選択したサイトからグリッド内の 1 つ以上の他のサイトにオブジェクトデータを移動します。
+
* データ移動の例 * ：サニーベールで新しいサイトを追加したために、ローリーでサイトの運用を停止するとします。この例では、すべてのオブジェクトデータを古いサイトから新しいサイトに移動します。ILMルールとILMポリシーを更新する前に、両方のサイトの容量を確認する必要があります。サニーベールサイトにローリーサイトのオブジェクトデータを保存できるだけの十分な容量があり、将来の成長に備えてサニーベールに十分な容量が残っていることを確認する必要があります。

+

NOTE: 十分な容量を確保するには、この手順を実行する前に、既存のサイトにストレージボリュームまたはストレージノードを追加するか、新しいサイトを追加しなければならない場合がありlink:../expand/index.html["グリッドを展開する"]ます。

* 選択したサイトからオブジェクトコピーを削除します。
+
* データの削除の例 * ：現在、 3 コピーの ILM ルールを使用して 3 つのサイト間でオブジェクトデータをレプリケートしているとします。サイトの運用を停止する前に、同等の 2-copy ILM ルールを作成して、 2 つのサイトにのみデータを格納することができます。2-copy ルールを使用する新しい ILM ポリシーをアクティブ化すると、 ILM 要件を満たさなくなるため、 StorageGRID は 3 番目のサイトからコピーを削除します。ただし、オブジェクトデータは引き続き保護され、残りの 2 つのサイトの容量は同じになります。

+

CAUTION: サイトの削除に対応するためにシングルコピーの ILM ルールを作成しないでください。ある期間にレプリケートコピーを 1 つしか作成しない ILM ルールには、データが永続的に失われるリスクがあります。オブジェクトのレプリケートコピーが 1 つしかない場合、ストレージノードに障害が発生したり、重大なエラーが発生すると、そのオブジェクトは失われます。また、アップグレードなどのメンテナンス作業中は、オブジェクトへのアクセスが一時的に失われます。





== 接続されたサイトの運用停止に関する追加要件

StorageGRID で接続されているサイトを削除する前に、次の点を確認してください。

* StorageGRIDシステムのすべてのノードの接続状態が* Connected *（）になっている必要がありますimage:../media/icon_alert_green_checkmark.png["緑のチェックマークアイコン"]が、アクティブなアラートが発生している可能性があります。
+

NOTE: 1 つ以上のノードが切断されている場合は、 Decommission Site ウィザードの手順 1~4 を完了できます。ただし、すべてのノードが接続されていないかぎり、運用停止プロセスを開始するウィザードの手順5を完了することはできません。

* 削除するサイトにロードバランシングに使用されるゲートウェイノードまたは管理ノードが含まれている場合は、同等の新しいノードを別のサイトに追加しなければならないことがありますlink:../expand/index.html["グリッドを展開する"]。サイトの運用停止手順 を開始する前に、クライアントが交換用ノードに接続できることを確認してください。
* 削除するサイトにハイアベイラビリティ（ HA ）グループ内のゲートウェイノードまたは管理ノードがある場合は、運用停止サイトウィザードの手順 1~4 を完了できます。ただし、運用停止プロセスを開始するウィザードの手順5を完了するには、これらのノードをすべてのHAグループから削除する必要があります。既存のクライアントがサイトのノードを含む HA グループに接続している場合は、サイトの削除後も引き続き StorageGRID に接続できることを確認する必要があります。
* 削除するサイトのストレージノードにクライアントが直接接続している場合は、サイトの運用停止手順 を開始する前に、それらのクライアントが他のサイトのストレージノードに接続できることを確認する必要があります。
* アクティブなILMポリシーの変更によって移動されるオブジェクトデータを格納できる十分なスペースを残りのサイトに確保する必要があります。場合によっては、接続されているサイトの運用停止を完了する前に、ストレージノード、ストレージボリューム、または新しいサイトの追加が必要になるlink:../expand/index.html["グリッドを展開する"]ことがあります。
* 手順 の運用停止が完了するまでに、十分な時間を確保する必要があります。StorageGRID の ILM プロセスの運用が停止されるまでに、サイトからオブジェクトデータを移動または削除するのに数日、数週間、場合によっては数カ月かかることがあります。
+

NOTE: サイトからオブジェクトデータを移動または削除するには、サイトのデータ量、システムの負荷、ネットワークのレイテンシ、および ILM に求められる変更の性質に応じて、数日、数週間、場合によっては数カ月かかることがあります。

* Decommission Site ウィザードの手順 1~4 をできるだけ早く完了する必要があります。実際の運用停止手順 を開始する前にサイトからデータを移動できるようにすると（ウィザードの手順 5 で「運用停止 * を開始」を選択して）、運用停止手順 の処理がより迅速になり、システム停止やパフォーマンスへの影響も少なくなります。




== 切断されたサイトの運用停止に関する追加要件

StorageGRID で切断されているサイトを削除する前に、次の点を確認してください。

* ネットアップのアカウント担当者に連絡しておきます。運用停止サイトのウィザードですべての手順を有効にする前に、要件を確認してください。
+

CAUTION: 切断されているサイトの運用停止は、サイトをリカバリしたり、サイトからオブジェクトデータをリカバリしたりできる可能性がある場合は、試行しないでください。を参照して link:how-site-recovery-is-performed-by-technical-support.html["テクニカルサポートによるサイトのリカバリ方法"]

* サイトのすべてのノードの接続状態が次のいずれかである必要があります。
+
** * Unknown *（image:../media/icon_alarm_blue_unknown.png["アイコンアラーム青不明"]）：不明な理由により、ノードが切断されているか、ノードのサービスが予期せず停止しています。たとえば、ノードのサービスが停止したり、電源障害や予期しない停止によってノードのネットワーク接続が失われたりする場合があります。
** * Administratively Down *（image:../media/icon_alarm_gray_administratively_down.png["アイコンのアラームグレーが管理上ダウンしています"]）：想定される理由により、ノードがグリッドに接続されていません。たとえば、ノード上のノードまたはサービスが正常にシャットダウンされたとします。


* 他のすべてのサイトのすべてのノードの接続状態が* Connected *（）になっている必要がありますimage:../media/icon_alert_green_checkmark.png["緑のチェックマークアイコン"]が、これらのノードではアクティブなアラートが発生することがあります。
* StorageGRID を使用してサイトに格納されているオブジェクトデータを表示したり読み出したりすることができなくなることを理解しておく必要があります。StorageGRID はこの手順 を実行する際、切断されているサイトのデータを一切保持しません。
+

NOTE: ILM ルールとポリシーが単一サイトの損失を防ぐように設計されている場合は、オブジェクトのコピーが残りのサイトに存在します。

* あるオブジェクトの唯一のコピーがサイトに格納されていた場合、オブジェクトは失われて読み出せないことを理解しておく必要があります。




== サイトを削除した場合の整合性に関する考慮事項

S3バケットの整合性によって、StorageGRIDがオブジェクトメタデータをすべてのノードとサイトに完全にレプリケートしてから、オブジェクトの取り込みが成功したことをクライアントに通知するかどうかが決まります。整合性では、オブジェクトの可用性と、異なるストレージノードおよびサイト間でのオブジェクトの整合性のバランスが維持されます。

StorageGRID でサイトを削除するときは、削除するサイトにデータが書き込まれていないことを確認する必要があります。そのため、各バケットまたはコンテナの整合性が一時的に上書きされます。サイトの運用停止プロセスの開始後、 StorageGRID は一時的に strong-site 整合性を使用し、オブジェクトのメタデータがサイトに書き込まれないようにします。

この一時的な上書きの結果、残りのサイトで複数のノードが使用できなくなった場合、サイトの運用停止中に発生するクライアントの書き込み、更新、および削除の処理が失敗する可能性があることに注意してください。
