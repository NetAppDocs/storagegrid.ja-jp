---
permalink: monitor/monitoring-storage-capacity.html 
sidebar: sidebar 
keywords: how to monitor storage capacity 
summary: 使用可能な合計スペースを監視して、 StorageGRID システムのオブジェクトまたはオブジェクトメタデータのストレージスペースが不足しないようにします。 
---
= ストレージ容量を監視
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
使用可能な合計スペースを監視して、 StorageGRID システムのオブジェクトまたはオブジェクトメタデータのストレージスペースが不足しないようにします。

StorageGRID は、オブジェクトデータとオブジェクトメタデータを別々に格納し、オブジェクトメタデータを含む分散 Cassandra データベース用に一定量のスペースをリザーブします。オブジェクトとオブジェクトメタデータ用に消費されるスペースの合計量のほか、それぞれので消費されるスペースの傾向を監視します。これにより、ノードの追加を事前に計画し、サービスの停止を回避できます。

StorageGRIDシステムでは、グリッド全体、サイトごと、およびストレージノードごとに実行できますlink:viewing-storage-tab.html["ストレージ容量の情報を表示します"]。



== グリッド全体のストレージ容量を監視します

グリッドの全体的なストレージ容量を監視して、オブジェクトデータとオブジェクトメタデータ用に十分な空きスペースが残っていることを確認します。時間の経過に伴うストレージ容量の変化を理解しておくと、グリッドの使用可能なストレージ容量が消費される前にストレージノードまたはストレージボリュームを追加する際に役立ちます。

Grid Managerのダッシュボードでは、グリッド全体およびデータセンターごとに使用可能なストレージ容量を簡単に評価できます。ノードページには、オブジェクトデータとオブジェクトメタデータの詳細な値が表示されます。

.手順
. グリッド全体および各データセンターで使用可能なストレージ容量を評価します。
+
.. [ダッシュボード]>[概要]*を選択します。
.. [Data space usage]の内訳と[Metadata Allowed space usage]の内訳カードの値をメモします。各カードには、ストレージ使用率、使用済みスペースの容量、サイトで使用可能または許可されている合計スペースが表示されます。
+

NOTE: アーカイブメディアはこの概要に含まれません。

+
image::../media/dashboard_data_and_metadata_space_usage_breakdown.png[データとメタデータのスペース使用量の内訳]

.. [Storage Over Time]カードのグラフをメモします。期間のドロップダウンを使用すると、ストレージの消費速度を確認できます。
+
image::../media/dashboard_storage_over_time.png[ストレージの経時的な推移グラフ]



. 使用済みのストレージ容量と、グリッドでオブジェクトデータとオブジェクトメタデータに使用できる残りのストレージ容量の詳細については、[Nodes]ページを使用してください。
+
.. [* nodes （ノード） ] を選択します
.. [*_grid_*>*Storage*] を選択します。
+
image::../media/nodes_deployment_storage_tab.png[Nodes Deployment Storage タブ]

.. [Storage Used - object data]*と*[Storage Used - object metadata]*のグラフにカーソルを合わせ、グリッド全体で使用可能なオブジェクトストレージとオブジェクトメタデータストレージの容量と使用済み容量の推移を確認します。
+

NOTE: サイトまたはグリッドの合計値には、オフラインのノードなど、指標が5分以上報告されていないノードは含まれません。



. グリッドの使用可能なストレージ容量がすべて使用される前に、ストレージノードまたはストレージボリュームを追加する拡張を実行します。
+
拡張のタイミングを計画する際には、追加のストレージを調達して設置するのにどれくらいの時間がかかるかを検討します。

+

NOTE: ILM ポリシーでイレイジャーコーディングを使用している場合は、既存のストレージノードの使用率が約 70% のときに拡張して、追加する必要のあるノードの数を減らすことができます。

+
ストレージの拡張計画の詳細については、を参照してlink:../expand/index.html["StorageGRID の拡張手順"]ください。





== 各ストレージノードのストレージ容量を監視します

各ストレージノードの使用可能な合計スペースを監視して、ノードに新しいオブジェクトデータ用の十分なスペースがあることを確認します。

.タスクの内容
使用可能なスペースは、オブジェクトの格納に使用できるストレージスペースの量です。ストレージノードの使用可能な合計スペースは、ノード内のすべてのオブジェクトストアの使用可能なスペースの合計です。

image::../media/calculating_watermarks.gif[Total Usable Space の概念図]

.手順
. ノード * > * _ ストレージノード _ * > * ストレージ * を選択します。
+
ノードのグラフと表が表示されます。

. [Storage Used - object data]グラフにカーソルを合わせます。
+
次の値が表示されます。

+
** * Used （ % ） * ：オブジェクトデータに使用されている合計使用可能スペースの割合。
** * Used * ：オブジェクトデータに使用されている合計使用可能スペースの量。
** * Replicated data * ：このノード、サイト、またはグリッド上のレプリケートオブジェクトデータの推定量。
** * イレイジャーコーディングデータ * ：このノード、サイト、またはグリッドにあるイレイジャーコーディングオブジェクトデータの推定量。
** * Total * ：このノード、サイト、またはグリッドで使用可能なスペースの総容量。[Used]の値はメトリックです `storagegrid_storage_utilization_data_bytes`。
+
image::../media/nodes_page_storage_used_object_data.png[Nodes ページ - ストレージの使用済みオブジェクトデータ]



. グラフの下の Volumes テーブルと Object Stores テーブルで使用可能な値を確認します。
+

NOTE: これらの値のグラフを表示するには、使用可能な列でグラフアイコンをクリックしimage:../media/icon_chart_new_for_11_5.png["グラフアイコン"]ます。

+
image::../media/nodes_page_storage_tables.png[オブジェクトはテーブルを格納します]

. 一定期間の値を監視して、使用可能なストレージスペースが消費される速度を見積もります。
. システムの正常な運用を維持するには、使用可能なスペースを使い切る前に、ストレージノードを追加するか、ストレージボリュームを追加するか、オブジェクトデータをアーカイブします。
+
拡張のタイミングを計画する際には、追加のストレージを調達して設置するのにどれくらいの時間がかかるかを検討します。

+

NOTE: ILM ポリシーでイレイジャーコーディングを使用している場合は、既存のストレージノードの使用率が約 70% のときに拡張して、追加する必要のあるノードの数を減らすことができます。

+
ストレージの拡張計画の詳細については、を参照してlink:../expand/index.html["StorageGRID の拡張手順"]ください。

+
link:../troubleshoot/troubleshooting-low-object-data-storage-alert.html["オブジェクトデータのストレージが少ない"]ストレージノードにオブジェクトデータを格納するためのスペースが十分に残っていない場合にアラートがトリガーされます。





== 各ストレージノードのオブジェクトメタデータ容量を監視します

各ストレージノードのメタデータ使用量を監視して、重要なデータベース処理に使用できるスペースが十分に残っていることを確認します。オブジェクトメタデータが許容されるメタデータスペースの 100% を超える前に、各サイトに新しいストレージノードを追加する必要があります。

.タスクの内容
StorageGRID は、冗長性を確保し、オブジェクトメタデータを損失から保護するために、各サイトでオブジェクトメタデータのコピーを 3 つ保持します。3 つのコピーは、各ストレージノードのストレージボリューム 0 でメタデータ用にリザーブされたスペースを使用して、各サイトのすべてのストレージノードに均等に分散されます。

場合によっては、グリッドのオブジェクトメタデータ容量がオブジェクトのストレージ容量よりも早く消費されることがあります。たとえば、一般に大量の小さいオブジェクトを取り込む場合は、オブジェクトストレージの容量が十分に残っている場合でも、ストレージノードを追加してメタデータ容量を増やす必要があります。

メタデータの使用量を増やすことができる要因には、ユーザのメタデータとタグのサイズと数、マルチパートアップロードのパートの合計数、 ILM のストレージの場所に対する変更の頻度などがあります。

.手順
. ノード * > * _ ストレージノード _ * > * ストレージ * を選択します。
. [Storage Used - object metadata]グラフにカーソルを合わせると、その時点の値が表示されます。
+
image::../media/storage_used_object_metadata.png[Storage Used - オブジェクトメタデータ]

+
使用済み（%）:: このストレージノードで使用されている使用可能なメタデータスペースの割合。
+
--
Prometheus指標： `storagegrid_storage_utilization_metadata_bytes`および `storagegrid_storage_utilization_metadata_allowed_bytes`

--
使用済み:: このストレージノードで使用されている使用可能なメタデータスペースのバイト数。
+
--
Prometheus指標： `storagegrid_storage_utilization_metadata_bytes`

--
許可:: このストレージノードでオブジェクトメタデータに使用できるスペース。この値がストレージノードごとにどのように異なるかについては、を参照してlink:../admin/managing-object-metadata-storage.html#allowed-metadata-space["使用可能なメタデータスペースの完全な概要"]ください。
+
--
Prometheus指標： `storagegrid_storage_utilization_metadata_allowed_bytes`

--
実際の予約:: このストレージノードでメタデータ用にリザーブされている実際のスペース。使用可能なスペースと重要なメタデータ処理に必要なスペースが含まれます。各ストレージノードのこの値の計算方法については、を参照してくださいlink:../admin/managing-object-metadata-storage.html#actual-reserved-space-for-metadata["メタデータ用に実際にリザーブされているスペースのフル概要"]。
+
--
_Prometheus指標は今後のリリースで追加される予定です。_

--


+

NOTE: サイトまたはグリッドの合計値には、オフラインのノードなど、指標が5分以上報告されていないノードは含まれません。

. Used （ % ） * 値が 70% 以上の場合は、各サイトにストレージノードを追加して StorageGRID システムを拡張します。
+

CAUTION: Low metadata storage * アラートは、「 Used （ % ）」の値が特定のしきい値に達するとトリガーされます。オブジェクトメタデータの使用スペースが使用可能なスペースの 100% を超えている場合、望ましくない結果が生じる可能性があります。

+
新しいノードを追加すると、サイト内のすべてのストレージノード間でオブジェクトメタデータが自動的にリバランシングされます。を参照してくださいlink:../expand/index.html["StorageGRID システムの拡張手順"]。





== スペース使用量の予測を監視します

ユーザデータとメタデータのスペース使用量予測を監視して、必要なタイミングを予測しlink:../expand/index.html["グリッドを展開する"]ます。

時間の経過とともに消費率が変化する場合は、[* Averaged Over *]プルダウンから短い範囲を選択して、最新の取り込みパターンのみを反映します。季節的なパターンに気付いた場合は、より長い範囲を選択してください。

StorageGRID を新規にインストールした場合は、スペース使用量の予測を評価する前に、データとメタデータが蓄積されていることを確認してください。

.手順
. ダッシュボードで、*[ストレージ]*を選択します。
. ダッシュボードカード、ストレージプール別のデータ使用量の予測、サイト別のメタデータ使用量の予測を表示します。
. 以下の値を使用して、データとメタデータのストレージ用に新しいストレージノードをいつ追加する必要があるかを見積もります。


image::../media/forecast-metadata-usage.png[サイト別のメタデータ使用量の予測]
