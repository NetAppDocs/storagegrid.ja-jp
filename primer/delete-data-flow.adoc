---
permalink: primer/delete-data-flow.html 
sidebar: sidebar 
keywords: StorageGRID, object, delete, deletion, object lock, bucket lifecycle, expiration, ilm, placement instruction 
summary: クライアントまたはテナントが削除処理を実行するか、オブジェクトの有効期間が終了して自動削除がトリガーされると、すべてのオブジェクトコピーがStorageGRID システムから削除されます。オブジェクト削除のデータフローが定義されています。 
---
= StorageGRIDでオブジェクトの削除を処理する方法
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
クライアントが削除処理を実行するか、またはオブジェクトの有効期間が終了して自動削除がトリガーされると、 StorageGRID システムからすべてのオブジェクトコピーが削除されます。オブジェクト削除のデータフローが定義されています。



== 削除階層

StorageGRID では、オブジェクトを保持するか削除するかを制御する方法がいくつかあります。オブジェクトはクライアント要求によって削除することも、自動で削除することもできます。StorageGRID は、 S3 バケットライフサイクルと ILM の配置手順よりも優先される S3 オブジェクトロックの設定をクライアントの削除要求よりも常に優先します。

* * S3 オブジェクトのロック * ：グリッドでグローバルな S3 オブジェクトのロック設定が有効になっている場合、 S3 クライアントは S3 オブジェクトのロックを有効にしたバケットを作成し、 S3 REST API を使用して、そのバケットに追加された各オブジェクトバージョンの最新の保持設定とリーガルホールド設定を指定できます。
+
** リーガルホールドの対象となっているオブジェクトバージョンは、どの方法でも削除できません。
** オブジェクトバージョンのretain-until-dateに達する前は、どの方法でもそのバージョンを削除できません。
** S3オブジェクトロックが有効になっているバケット内のオブジェクトは、ILMによって「無期限」に保持されます。ただし、それまでの保持期間が終了したあとは、クライアント要求やバケットライフサイクルの終了によってオブジェクトバージョンを削除できます。
** S3クライアントがデフォルトのretain-until-dateをバケットに適用する場合、オブジェクトごとにretain-until-dateを指定する必要はありません。


* *クライアント削除要求*：S3クライアントはオブジェクトの削除要求を実行できます。クライアントがオブジェクトを削除すると、そのオブジェクトのすべてのコピーが StorageGRID システムから削除されます。
* *バケット内のオブジェクトを削除*：Tenant Managerユーザは、このオプションを使用して、選択したバケット内のオブジェクトとオブジェクトバージョンのすべてのコピーをStorageGRID システムから完全に削除できます。
* * S3 バケットライフサイクル * ： S3 クライアントは、 Expiration アクションを指定するライフサイクル設定をバケットに追加できます。バケットライフサイクルが設定されている場合、クライアントが先にオブジェクトを削除しないかぎり、 Expiration アクションで指定された日付または日数が経過した時点で、 StorageGRID はオブジェクトのすべてのコピーを自動的に削除します。
* * ILM の配置手順 * ：バケットで S3 オブジェクトロックが有効になっておらず、バケットライフサイクルがない場合、 StorageGRID は ILM ルールの最後の期間が終了してオブジェクトにそれ以降の配置が指定されていないときにオブジェクトを自動的に削除します。
+

NOTE: S3バケットライフサイクルが設定されている場合は、ライフサイクルフィルタに一致するオブジェクトのILMポリシーがライフサイクル有効期限のアクションで上書きされます。その結果、 ILM のオブジェクト配置手順がすべて終了したあとも、オブジェクトがグリッドに保持されることがあります。



詳細については、を参照してください link:../ilm/how-objects-are-deleted.html["オブジェクトの削除方法"] 。



== クライアント削除のデータフロー

image::../media/delete_data_flow.png[クライアントによる削除のデータフロー]

. LDR サービスがクライアントアプリケーションから削除要求を受信
. LDR サービスが、メタデータストアを更新してオブジェクトをクライアント要求に対して見かけ上削除し、 ILM エンジンにオブジェクトデータのすべてのコピーの削除を指示します。
. オブジェクトがシステムから削除されます。メタデータストアが更新されてオブジェクトメタデータが削除されます。




== ILM による削除のデータフローを示します

image::../media/automatic_deletion_data_flow.png[自動削除のデータフロー]

. オブジェクトの削除が必要であることを ILM エンジンが確認します。
. ILM エンジンがメタデータストアに通知します。メタデータストアがオブジェクトメタデータを更新して、オブジェクトをクライアント要求に対して見かけ上削除します。
. ILM エンジンがオブジェクトのすべてのコピーを削除します。メタデータストアが更新されてオブジェクトメタデータが削除されます。

