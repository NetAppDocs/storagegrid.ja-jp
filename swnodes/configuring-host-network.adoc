---
permalink: swnodes/configuring-host-network.html 
sidebar: sidebar 
keywords: how to configure the host network 
summary: ホストへの Linux のインストールの完了後、このあとに導入する StorageGRID ノードにマッピングする一連のネットワークインターフェイスを準備するために、各ホストでいくつかの追加の設定が必要になることがあります。 
---
= ホストネットワークを構成する (Linux)
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ホストへの Linux のインストールの完了後、このあとに導入する StorageGRID ノードにマッピングする一連のネットワークインターフェイスを準備するために、各ホストでいくつかの追加の設定が必要になることがあります。


NOTE: 「Linux」は、RHEL、Ubuntu、または Debian のデプロイメントを指します。サポートされているバージョンのリストについては、 https://imt.netapp.com/matrix/#welcome["NetApp Interoperability Matrix Tool（IMT）"^] 。

.開始する前に
* を確認しておきますlink:../network/index.html["StorageGRID ネットワークのガイドライン"]。
* に関する情報を確認しておきlink:node-container-migration-requirements.html["ノードコンテナの移行要件"]ます。
* 仮想ホストを使用している場合は、<<mac_address_cloning,MAC アドレスのクローニングに関する考慮事項と推奨事項>>ホスト ネットワークを構成する前に。



NOTE: VM をホストとして使用する場合は、仮想ネットワークアダプタとして VMXNET 3 を選択する必要があります。VMware E1000 ネットワークアダプタは、特定の Linux のディストリビューションで導入された StorageGRID コンテナで接続の問題が発生しました。

.タスクの内容
グリッドノードは、グリッドネットワークにアクセスできる必要があります。また、管理ネットワークとクライアントネットワークにアクセスすることもできます。このアクセスを確立するには、ホストの物理インターフェイスを各グリッドノードの仮想インターフェイスに関連付けるマッピングを作成します。ホストインターフェイスを作成するときにわかりやすい名前を使用すると、すべてのホストへの導入が簡単になり、移行も可能になります。

ホストと 1 つ以上のノードで、同じインターフェイスを共有できます。たとえば、ホストアクセス用とノード管理ネットワークアクセス用のインターフェイスに同じものを使用すると、ホストとノードをメンテナンスしやすくなります。ホストと個々のノードで同じインターフェイスを共有できますが、 IP アドレスはすべて異なっている必要があります。IPアドレスは、ノード間、またはホストと任意のノード間で共有できません。

グリッドネットワークのインターフェイスについては、ホストのすべての StorageGRID ノードで同じホストネットワークインターフェイスを使用したり、ノードごとに異なるホストネットワークインターフェイスを使用したり、任意のインターフェイスを使用したりできます。ただし、通常は、単一のホストのグリッドネットワークと管理ネットワークの両方のインターフェイス、またはいずれかのノードのグリッドネットワークのインターフェイスと別のホストのクライアントネットワークのインターフェイスに同じホストネットワークインターフェイスを使用することはありません。

このタスクはさまざまな方法で実行できます。たとえば、ホストが仮想マシンで、ホストごとに1つまたは2つのStorageGRID ノードを導入する場合は、ハイパーバイザーで正しい数のネットワークインターフェイスを作成し、1対1のマッピングを使用できます。本番環境用のベアメタルホストに複数のノードを導入する場合は、 Linux ネットワークスタックの VLAN と LACP のサポートを利用してフォールトトレランスと帯域幅の共有を実現できます。以降のセクションでは、これら両方の例について詳細なアプローチを紹介します。これらのいずれかの例を使用する必要はありません。ニーズに合ったアプローチを使用できます。


NOTE: ボンドデバイスやブリッジデバイスをコンテナネットワークインターフェイスとして直接使用しないでください。これにより、カーネル問題 が原因で発生するノードの起動が妨げられ、コンテナネームスペース内のボンドデバイスおよびブリッジデバイスで MACVLAN が使用される可能性があります。代わりに、 VLAN ペアや仮想イーサネット（ veth ）ペアなどの非ボンディングデバイスを使用してください。このデバイスをノード構成ファイルのネットワークインターフェイスとして指定してください。



== MAC アドレスのクローニングに関する考慮事項と推奨事項

.[[mac_address_cloning]]
MAC アドレスのクローニングでは、コンテナでホストの MAC アドレスが使用され、ホストでは指定したアドレスまたはランダムに生成されたアドレスの MAC アドレスが使用されます。プロミスキャスモードのネットワーク設定を使用しないようにするには、 MAC アドレスのクローニングを使用します。



=== MAC クローニングのイネーブル化

環境によっては、管理ネットワーク、グリッドネットワーク、およびクライアントネットワークに専用の仮想 NIC を使用できるため、 MAC アドレスのクローニングによってセキュリティを強化できます。コンテナでホストの専用 NIC の MAC アドレスを使用すると、プロミスキャスモードのネットワーク設定を回避できます。


NOTE: MAC アドレスクローニングは、仮想サーバ環境で使用するためのものであり、物理アプライアンスのすべての構成で正常に機能しない場合があります。


NOTE: MAC クローニングのターゲットインターフェイスがビジー状態のためにノードを起動できない場合は、ノードを起動する前にリンクを「停止」に設定しなければならないことがあります。また、リンクが稼働しているときに仮想環境でネットワークインターフェイス上の MAC クローニングが実行されないことがあります。インターフェイスがビジーなためにノードで MAC アドレスの設定が失敗してノードが起動しなかった場合は、問題 を修正する前にリンクを「停止」に設定することがあります。

MAC アドレスクローニングは、デフォルトでは無効になっており、ノード設定キーで設定する必要があります。StorageGRID をインストールするときに有効にする必要があります。

ネットワークごとに 1 つのキーがあります。

* `ADMIN_NETWORK_TARGET_TYPE_INTERFACE_CLONE_MAC`
* `GRID_NETWORK_TARGET_TYPE_INTERFACE_CLONE_MAC`
* `CLIENT_NETWORK_TARGET_TYPE_INTERFACE_CLONE_MAC`


キーを「 true 」に設定すると、コンテナでホストの NIC の MAC アドレスが使用されます。さらに、ホストは指定されたコンテナネットワークの MAC アドレスを使用します。デフォルトでは、コンテナアドレスはランダムに生成されたアドレスですが、ノード構成キーを使用して設定した場合は `_NETWORK_MAC`そのアドレスが代わりに使用されます。ホストとコンテナの MAC アドレスは常に異なります。


NOTE: ハイパーバイザーでプロミスキャスモードも有効にせずに仮想ホストの MAC クローニングを有効にすると、ホストのインターフェイスを使用して原因 Linux ホストのネットワークが停止する可能性があります。



=== MAC クローン作成の使用例

MAC クローニングでは、次の 2 つのユースケースを検討します。

* MACクローニングが有効になっていない：ノード構成ファイルのキーが設定されていない場合、または「false」に設定されている場合 `_CLONE_MAC`、ホストはホストNIC MACを使用し、キーでMACが指定されていないかぎり、コンテナはStorageGRIDによって生成されたMACを持ち `_NETWORK_MAC`ます。キーにアドレスが設定されている場合、 `_NETWORK_MAC`コンテナはキーで指定されたアドレスを持ち `_NETWORK_MAC`ます。このキーの設定では、プロミスキャスモードを使用する必要があります。
* MACクローニングが有効：ノード構成ファイルのキーが「true」に設定されている場合、 `_CLONE_MAC`コンテナはホストNICのMACを使用し、キーでMACが指定されていないかぎり、ホストはStorageGRIDで生成されたMACを使用し `_NETWORK_MAC`ます。キーにアドレスが設定されている場合、 `_NETWORK_MAC`ホストは生成されたアドレスではなく、指定されたアドレスを使用します。このキーの設定では、プロミスキャスモードは使用しないでください。



NOTE: MACアドレスクローニングを使用せず、ハイパーバイザーによって割り当てられたMACアドレス以外のMACアドレスのデータをすべてのインターフェイスで送受信できるようにする場合は、 [Promiscuous Mode]、[MAC Address Changes]、および[Forged Transmits]で、仮想スイッチおよびポートグループレベルのセキュリティプロパティが[Accept]に設定されていることを確認します。仮想スイッチに設定された値は、ポートグループレベルの値によって上書きできるため、両方のレベルで設定が同じであることを確認してください。

MACクローニングをイネーブルにするには、を参照してくださいlink:creating-node-configuration-files.html["ノード構成ファイルの作成手順"]。



=== MAC クローニングの例

インターフェイスens256およびノード構成ファイルの次のキーに対して、MACアドレス11：22：33：44：55：66のホストでMACクローニングを有効にする例。

* `ADMIN_NETWORK_TARGET = ens256`
* `ADMIN_NETWORK_MAC = b2:9c:02:c2:27:10`
* `ADMIN_NETWORK_TARGET_TYPE_INTERFACE_CLONE_MAC = true`


*結果*：ens256のホストMACはb2：9c：02：c2：27：10、管理ネットワークMACは11：22：33：44：55：66です。



== 例 1 ：物理 NIC または仮想 NIC への 1 対 1 のマッピング

例 1 では、ホスト側の設定がほとんどまたはまったく必要ない単純な物理インターフェイスのマッピングについて説明します。

image::../media/rhel_install_vlan_diag_1.gif[VLANのインストール図]

Linuxオペレーティングシステムは、 `ensXYZ`インストール時または起動時、あるいはインターフェースがホットアドされたときに、インターフェースを自動的に追加します。起動後にインターフェースが自動的に起動するように設定されていることを確認する以外に、構成は必要ありません。後の構成プロセスで正しいマッピングを提供できるように、どの ensXYZ がどのStorageGRIDネットワーク (グリッド、管理、またはクライアント) に対応するかを決定する必要があります。

この図は複数の StorageGRID ノードを示していますが、通常はこの構成をシングルノードの VM に使用します。

スイッチ 1 が物理スイッチの場合は、インターフェイス 10G1 ～ 10G3 に接続されたポートをアクセスモードに設定し、適切な VLAN に配置する必要があります。



== 例 2 ： LACP ボンドを使用した VLAN の伝送

例 2 は、ネットワークインターフェイスのボンディングおよび使用している Linux ディストリビューションでの VLAN インターフェイスの作成に関する十分な知識があることを前提としています。

.タスクの内容
例 2 では、汎用の柔軟な VLAN ベースのスキームを使用して、使用可能なすべてのネットワーク帯域幅を単一のホスト上のすべてのノードで共有する方法について説明します。この例は、ベアメタルホストに特に該当します。

この例を理解するために、各データセンターにグリッドネットワーク、管理ネットワーク、クライアントネットワーク用に 3 つのサブネットがあるとします。サブネットは個別の VLAN （ 1001 、 1002 、 1003 ）上にあり、 LACP ボンディングされたトランクポート（ bond0 ）でホストに提示されます。この場合、ボンドに bond0.1001 、 bond0.1002 、および bond0.1003 の 3 つの VLAN インターフェイスを設定します。

同じホスト上のノードネットワークに別々の VLAN とサブネットが必要な場合は、ボンドに VLAN インターフェイスを追加してホストにマッピングできます（図の bond0.1004 と表示）。

image::../media/rhel_install_vlan_diag_2.gif[VLANインターフェイス]

.手順
. StorageGRID ネットワークの接続に使用するすべての物理ネットワークインターフェイスを単一の LACP ボンドとしてまとめます。
+
すべてのホストのボンドに同じ名前を使用します。例: `bond0` 。

. このボンドを関連する「物理デバイス」として使用するVLANインターフェイスを、標準のVLANインターフェイスの命名規則に従って作成します `physdev-name.VLAN ID`。
+
手順 1 と 2 のそれぞれについて、ネットワークリンクの反対側の終端にあるエッジスイッチで適切な設定を行う必要があります。エッジスイッチのポートも LACP ポートチャネルに集約してトランクとして設定し、必要なすべての VLAN を許可する必要があります。

+
このホストごとのネットワーク構成スキームに使用できるサンプルのインターフェイス構成ファイルが提供されています。



.関連情報
* link:example-etc-network-interfaces.html["UbuntuとDebianの/etc/network/interfacesの例"]
* link:example-etc-sysconfig-network-scripts.html["RHEL の /etc/sysconfig/network-scripts の例"]

