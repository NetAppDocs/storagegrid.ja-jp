---
permalink: tenant/grid-federation-manage-cross-grid-replication.html 
sidebar: sidebar 
keywords: grid federation, cross-grid replication, use grid federation connection, replicate client delete markers, s3 bucket 
summary: テナントアカウントの作成時にUse grid federation connection権限が割り当てられている場合は、グリッド間レプリケーションを使用して、テナントソースグリッド上のバケットとテナントデスティネーショングリッド上のバケット間でオブジェクトを自動的にレプリケートできます。グリッド間レプリケーションは、一方または両方の方向で実行できます。 
---
= グリッド間レプリケーションを管理します
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
テナントアカウントの作成時に「Use grid federation connection *」権限が割り当てられていた場合は、グリッド間レプリケーションを使用して、テナントのソースグリッド上のバケットとテナントのデスティネーショングリッド上のバケット間でオブジェクトを自動的にレプリケートできます。グリッド間レプリケーションは、一方または両方の方向で実行できます。



== グリッド間レプリケーションのワークフロー

次のワークフロー図は、2つのグリッド上のバケット間でグリッド間レプリケーションを設定する手順をまとめたものです。これらの手順については、以下で詳しく説明します。

image::../media/grid-federation-cgr-workflow.png[グリッド間レプリケーションのワークフロー]



== グリッド間レプリケーションを設定する

グリッド間レプリケーションを使用する前に、各グリッドの対応するテナントアカウントにサインインし、同一のバケットを作成する必要があります。その後、一方または両方のバケットでグリッド間レプリケーションを有効にできます。

.開始する前に
* グリッド間レプリケーションの要件を確認しておく必要があります。を参照して link:../admin/grid-federation-what-is-cross-grid-replication.html["クロスグリッドレプリケーションとは"]
* を使用しているlink:../admin/web-browser-requirements.html["サポートされている Web ブラウザ"]。
* テナントアカウントには* Use grid federation connection *権限があり、両方のグリッドに同一のテナントアカウントが存在します。を参照して link:../admin/grid-federation-manage-tenants.html["グリッドフェデレーション接続に許可されているテナントを管理します"]
* サインインするテナントユーザが両方のグリッドにすでに存在し、を含むユーザグループに属している。link:tenant-management-permissions.html["rootアクセス権限"]
* テナントのデスティネーショングリッドにローカルユーザとしてサインインする場合は、テナントアカウントのrootユーザがそのグリッドでユーザアカウントのパスワードを設定している必要があります。




=== 同一のバケットを2つ作成します

最初の手順として、各グリッドの対応するテナントアカウントにサインインし、同一のバケットを作成します。

.手順
. グリッドフェデレーション接続のいずれかのグリッドから、新しいバケットを作成します。
+
.. 両方のグリッドに存在するテナントユーザのクレデンシャルを使用してテナントアカウントにサインインします。
+

NOTE: テナントのデスティネーショングリッドにローカルユーザとしてサインインできない場合は、テナントアカウントのrootユーザがユーザアカウントのパスワードを設定していることを確認します。

.. の指示に従ってくださいlink:creating-s3-bucket.html["S3バケットを作成"]。
.. [オブジェクト設定の管理]*タブで、*[オブジェクトのバージョン管理を有効にする]*を選択します。
.. StorageGRID システムでS3オブジェクトロックが有効になっている場合は、バケットでS3オブジェクトロックを有効にしないでください。
.. [ * バケットの作成 * ] を選択します。
.. [ 完了 ] を選択します。


. 同じテナントアカウントに対して同じバケットをグリッドフェデレーション接続のもう一方のグリッドに作成するには、上記の手順を繰り返します。
+

TIP: 必要に応じて、各バケットで異なるリージョンを使用できます。





=== グリッド間レプリケーションを有効にする

これらの手順は、いずれかのバケットにオブジェクトを追加する前に実行する必要があります。

.手順
. オブジェクトを複製するグリッドから開始して、link:../admin/grid-federation-what-is-cross-grid-replication.html["一方向のグリッド間レプリケーション"]次を有効にします。
+
.. バケットのテナントアカウントにサインインします。
.. ダッシュボードで* View Buckets *を選択するか、* storage（S3）*>* Buckets *を選択します。
.. 表からバケット名を選択して、バケットの詳細ページにアクセスします。
.. [クロスグリッドレプリケーション]*タブを選択します。
.. [有効化]*を選択し、要件のリストを確認します。
.. すべての要件を満たしている場合は、使用するグリッドフェデレーション接続を選択します。
.. 必要に応じて、[Replicate delete markers]の設定を変更して、S3クライアントがバージョンIDを含まない削除要求をソースグリッドに対して実行した場合のデスティネーショングリッドでの動作を確認します。
+
*** * Yes *（デフォルト）：削除マーカーがソースバケットに追加され、デスティネーションバケットにレプリケートされます。
*** * No *：削除マーカーはソースバケットに追加されますが、デスティネーションバケットにはレプリケートされません。
+
image::../media/grid-federation-cross-grid-replication-client-deletes.png[両方のグリッドでのレプリケートクライアントの削除を示すイメージ]

+

NOTE: 削除要求にバージョンIDが含まれている場合は、そのオブジェクトのバージョンがソースバケットから完全に削除されます。StorageGRID はバージョンIDを含む削除要求をレプリケートしないため、同じオブジェクトバージョンがデスティネーションから削除されることはありません。

+
詳細は、を参照してください link:../admin/grid-federation-what-is-cross-grid-replication.html["クロスグリッドレプリケーションとは"] 。



.. 必要に応じて、*クロスグリッドレプリケーション*監査カテゴリの設定を変更して、監査メッセージの量を管理します。
+
*** *エラー*（デフォルト）：失敗したグリッド間レプリケーション要求のみが監査出力に含まれます。
*** * Normal *：グリッドをまたぐレプリケーション要求がすべて含まれるため、監査出力の量が大幅に増加します。


.. 選択内容を確認します。両方のバケットが空でない限り、これらの設定を変更することはできません。
.. [有効にしてテスト]*を選択します。
+
しばらくすると、成功のメッセージが表示されます。このバケットに追加されたオブジェクトは、もう一方のグリッドに自動的にレプリケートされます。*クロスグリッドレプリケーション*は、バケットの詳細ページで有効になっている機能として表示されます。



. 必要に応じて、もう一方のグリッドの対応するバケットに移動しlink:../admin/grid-federation-what-is-cross-grid-replication.html["双方向のグリッド間レプリケーションを有効にします"]ます。




== グリッド間のレプリケーションをテスト

バケットでクロスグリッドレプリケーションが有効になっている場合は、接続とグリッド間レプリケーションが正しく機能していること、ソースとデスティネーションのバケットがすべての要件を満たしていること（バージョン管理が有効になっている場合など）を確認する必要があります。

.開始する前に
* を使用しているlink:../admin/web-browser-requirements.html["サポートされている Web ブラウザ"]。
* が設定されたユーザグループに属しているlink:tenant-management-permissions.html["rootアクセス権限"]必要があります。


.手順
. バケットのテナントアカウントにサインインします。
. ダッシュボードで* View Buckets *を選択するか、* storage（S3）*>* Buckets *を選択します。
. 表からバケット名を選択して、バケットの詳細ページにアクセスします。
. [クロスグリッドレプリケーション]*タブを選択します。
. [ 接続のテスト * ] を選択します。
+
接続が正常な場合は、成功バナーが表示されます。そうしないとエラーメッセージが表示され、ユーザとグリッド管理者はこのメッセージを使用して問題 を解決できます。詳細については、を参照してください link:../admin/grid-federation-troubleshoot.html["グリッドフェデレーションエラーをトラブルシューティングする"]。

. グリッド間レプリケーションが両方向で実行されるように設定されている場合は、もう一方のグリッドの対応するバケットに移動して*[Test connection]*を選択し、グリッド間レプリケーションが反対方向で動作していることを確認します。




== グリッド間レプリケーションを無効にします

オブジェクトをもう一方のグリッドにコピーする必要がなくなった場合は、グリッド間レプリケーションを永続的に停止できます。

グリッド間レプリケーションを無効にする前に、次の点に注意してください。

* グリッド間レプリケーションを無効にしても、グリッド間ですでにコピーされているオブジェクトは削除されません。たとえば、グリッド1上ののオブジェクトのうち、グリッド2上のにコピーされた `my-bucket`オブジェクト `my-bucket`は、そのバケットでグリッド間レプリケーションを無効にしても削除されません。これらのオブジェクトを削除する場合は、手動で削除する必要があります。
* 各バケットでグリッド間レプリケーションが有効になっている場合（双方向でレプリケーションが発生した場合）は、一方または両方のバケットでグリッド間レプリケーションを無効にすることができます。たとえば、グリッド1からグリッド2へのオブジェクトのレプリケーションを無効にしながら、グリッド2から `my-bucket`グリッド1への `my-bucket`オブジェクトのレプリケーションを `my-bucket`続行 `my-bucket`できます。
* グリッドフェデレーション接続を使用するテナントの権限を削除するには、グリッド間レプリケーションを無効にする必要があります。を参照して link:../admin/grid-federation-manage-tenants.html["許可されたテナントを管理する"]
* オブジェクトを含むバケットでクロスグリッドレプリケーションを無効にすると、ソースとデスティネーションの両方のバケットからすべてのオブジェクトを削除しないかぎり、クロスグリッドレプリケーションを再度有効にすることはできません。
+

CAUTION: 両方のバケットが空でない限り、レプリケーションを再度有効にすることはできません。



.開始する前に
* を使用しているlink:../admin/web-browser-requirements.html["サポートされている Web ブラウザ"]。
* が設定されたユーザグループに属しているlink:tenant-management-permissions.html["rootアクセス権限"]必要があります。


.手順
. レプリケートするオブジェクトが含まれていないグリッドから、バケットのグリッド間レプリケーションを停止します。
+
.. バケットのテナントアカウントにサインインします。
.. ダッシュボードで* View Buckets *を選択するか、* storage（S3）*>* Buckets *を選択します。
.. 表からバケット名を選択して、バケットの詳細ページにアクセスします。
.. [クロスグリッドレプリケーション]*タブを選択します。
.. [レプリケーションを無効にする]*を選択します。
.. このバケットでグリッド間レプリケーションを無効にする場合は、テキストボックスに「* Yes *」と入力し、* Disable *を選択します。
+
しばらくすると、成功のメッセージが表示されます。このバケットに追加された新しいオブジェクトを他のグリッドに自動的にレプリケートすることはできなくなります。*クロスグリッドレプリケーション*は、[Buckets]ページに有効な機能として表示されなくなりました。



. グリッド間レプリケーションが双方向で実行されるように設定されている場合は、もう一方のグリッドの対応するバケットに移動し、別の方向へのグリッド間レプリケーションを停止します。

